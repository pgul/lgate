       Организация ftn-линка via e-mail

   В этом случае все почтовые и остальные аттачи на узел, с которым у вас
линк, отправляются обычной почтой в uucode или base64. Для этого вам
необходимо завести локального пользователя вашей почтовой системы, скажем,
fnet, попросить удаленного сисопа сделать то же и написать в gate.cfg
примерно следующее:
route-uue fnet@lucky.carrier.kiev.ua 2:463/68
filebox=fnet
где 2:463/68 - узел, с которым вы делаете линк,
fnet - ваш локальный пользователь,
fnet@lucky.carrier.kiev.ua - пользователь на удаленном узле.
Если вы используете не arcmail attach и не binkley style, то вам
необходимо каким-то образом все аттачи на этот узел складывать в
отдельный каталог и написать следующее:
route-uue fnet@lucky.carrier.kiev.ua 2:463/68 c:\fido\out\2\463\68
где c:\fido\out\2\463\68 - каталог, куда складываются все аттачи для 2:463/68.
Для binkley style достаточно вместо параметра pktin указать параметр
binkoutbound.

  Файл конфигурации, если не указан явно в командной строке ключом -C,
ищется как %HOME/etc/gate.conf;./gate.conf;/etc/gate.conf в UNIX-версии,
и в каталоге, где расположен сам attuucp.exe, в MSDOS- и OS/2-версиях.

   Вот полное описание формата и ключей route-uue:

route-uue [/base64] [/pgp] [/split=<size>] [/password=<passwd>] [/sign] [/confirm[=t1,t2]] <internet-address> <ftn-address> [<path>]

<path> - файлбокс. Все файлы из этого каталога будут отправляться по
        данному адресу.
/base64, /mime - слать файл в base64;
/pgp  - слать файл pgp encrypted (для этого pgp должен быть инсталлирован
        с обеих сторон, и должен быть известен public pgp key той стороны).
        В этом случае ставится "Content-Transfer-Encoding: x-pgp".
/sign - сделать pgp-сигнатуру (pgp должен быть установлен). При этом
        будет требоваться pgp-сигнатура при приеме файлов от этого линка,
        т.е. этот ключ должен быть установлен с обеих сторон. Сигнатура
        пишется полем заголовка "X-PGP-Sig:" (многострочным).
/password - указать пароль на линк. Этот же пароль будет проверяться
        при приеме файлов от этого линка, т.е. он должен быть прописан
        с обеих сторон. Пароль совершенно не нужен, если используется
        ключ /sign, т.к. pgp обеспечивает гораздо большую степень защиты.
        Пароль регистрозависим, максимальная длина 32 символа. Пишется
        открытым текстом в поле заголовка X-Password каждой части.
/split - разбивать большие файлы на части размером не более <size> килобайт.
        Файл будет автоматически собираться из частей на приеме, если
        там используется attuucp или любой другой софт, понимающий
        Content-Type: message/partial.
/confirm - сохранить отправляемое письмо в каталоге sentdir и запросить
        подтверждение приема файла ("X-Confirm-To:"). Письма будут
        удалены после получения подтверждения, либо отправлены заново
        в случае получения сообщения об ошибке (например, crc error).
        При отсутствии подтверждения файл будет отправляться через
        интервалы t1 в течение t2. Интервалы задаются в формате
        NNh или NNd, например, "/confirm=12h,3d" - отправлять каждые
        12 часов в течение трех суток, если нет подтверждения.
        Если интервалы не указаны, используются предыдущие. Если
        вообще не указаны, используется умолчание 12h,3d. Для того,
        чтобы это работало, удаленный софт должен поддерживать этот
        формат запросов/подтверждений (пока это только LuckyGate 6.01+),
        иначе каждый файл будет отправляться несколько раз (дупы).

        Формат запроса: в заголовке должно быть поле
        X-Confirm-To: user@domain
        где user@domain - адрес, куда отправить подтверждение.
        Использование угловых и круглых скобок не допускается (пока?).

        Формат подтверждения: в заголовке письма должно быть поле
        X-Confirm-Status: (OK|FAIL) <msgid> (comment)
        msgid - message-id или, для multipart, part id в угловых скобках.
        OK означает успешную распаковку всего файла (а не успешное
        получение письма). Comment - произвольный комментарий
        (причина fail, дата приема etc.). Например,
        X-Confirm-Status: OK <12-234-asd@lucky.net> (unsecure)
        X-Confirm-Status: FAIL <21-432-asd@lucky.net> (can't decode pgp)


   Ключи /pgp и /sign могут применяться как вместе, так и по отдельности,
потому что выполняют разные задачи.

   Если не указано ни /mime, ни /pgp, используется uuencode, в этом
случае ставится "Content-Transfer-Encoding: x-uuencode".

   Файлаттач считается секьюрным, если он пришел от известного адреса
(описанного в одной из команд route-uue) и содержит указанные в этой
строке аттрибуты секьюрити: пароль либо pgp-сигнатуру. Такие файлаттачи
складываются в каталог pktout для последующего тоссинга. Несекьюрные
аттачи (от неизвестных адресов, а также с отсутствующим или неправильным
паролем или pgp-сигнатурой, если что-то из этого нужно) складываются в
каталог unsecure, если он указан, либо пересылаются постмастеру, если
не указан. Письма, не содержащие файлаттачей (например, сообщения роботов
о невозможности доставки), пересылаются постмастеру.

   Всем этим занимается утилита attuucp.exe, поэтому вам необходимо
вставить ее вызов в начале (для отправки аттачей) и в конце (для
обработки пришедших пакетов) файла uupc.bat.

   Проследите за тем, чтобы весь netmail для этого узла паковался в
почтовые пакеты, чтобы на них не ставились аттрибуты hold, direct, crash
и пр., либо (что imho хуже) нужно поставить параметр norm-only=no.
При обмене файлэхами с узлом, на котором нет LuckyGate, лучше сами файлы
паковать в один большой zic, тогда у них сохранится дата и время
создания. При обмене LuckyGate-LuckyGate, он сам позаботится об этом.
Также надо быть аккуратным с отправкой больших архивов - на некоторых
узлах максимальный размер письма ограничен до 300K. В этом случае вам
следует попросить своего постмастера увеличить его мегабайт до пяти
(смотря какие архивы вы планируете передавать), либо использовать
ключ /split, если на той стороне тоже LuckyGate.

   FTN-аттачи, отправленные LuckyGate'ом, можно отличить от обычных
писем по наличию поля заголовка "X-FTNattach-Version:" (в данный
момент там ставится "1.0"). В поле "Content-Type:" ставятся параметры
"crc32=" и "name=". Поле "Subject:" формируется по следующему
принципу:
Subject: 12345678.su0, 2/3; 22.08.99 10:52:06
или, если разбиения на части нет, просто
Subject: 12345678.su0; 02.11.98 10:52:06
Дата и время - это время модификации (mtime) отправляемого файла,
локальное для отправителя.

   Если в файле uupc\conf\passwd описать юзера примерно так:
fnet::::"FidoNet Daemon":c:\lgate:c:\lgate\attuucp.exe -l<
то есть последним параметром (shell) указать "attuucp -l<", то приходящие
на этот адрес письма будут обрабатываться на этапе uuxqt (для этого версия
UUPC не должна быть младше 6.14h). В этом случае можно не добавлять запуск
attuucp.exe в конце uupc.bat (но в начале все равно надо добавить).

   Для sendmail в файле aliases можно прописать
fnet: "| c:\lgate\attuucp.exe -l"

   Если один файл нужно отправить нескольким линкам, он будет отправлен
одним запуском sendmail, если для этих линков прописан одинаковый
метод кодирования, не используется pgp encrypting, не нужно запрашивать
подтверждение, и либо все понимают разбиение на части, либо всем файл
можно отправить одним куском.

   Во время работы attuucp по отправке файлов нельзя параллельно запускать
allfix - в этом случае возможна потеря файлов.



       Темплейты.
       
Если строка начинается с @if, @else, @endif, @ifdef, @ifndef, @set,
@text, @vars или для badaddr-tpl @header - это служебная строка.
Все остальные строки, начинающиеся с символа '@' игнорируются и могут
быть использованы как комментарии. Вместо @text подставляется текст
оригинального письма, вместо @header - его заголовок.
Строка @if имеет вид
@if [not] <line1>==<line2>
например,
@if [reason]==binary
или
@if not "[tomaster]"=="yes"
Строки сравниваются ignore case. Строка
@ifdef <var>
эквивалентна
@if not "<var>"==""
ну а
@ifndef <var>
эквивалентна
@if "<var>"==""
Кроме того, возможно сравнение с маской или с регулярным выражением
при помощи операции "=~", например,
@if [fromaddr] =~ MAILER-DAEMON@*
или
@if not [reason] =~ /^itwit-(to|from)$/

Строка @set имеет вид
@set <var>=<string>
Строка <string> может быть заключена в кавычки. Например,
@set GateName="Fido<->Internet Gate"
В тексте (в т.ч. в служебных строках) все подстроки типа [var] заменяются
на значение переменной var, или выкидываются, если такой переменной нет,
если только не установлено "@vars no". Регистр букв в именах переменных
роли не играет. Присвоить или изменить значение переменной можно при
помощи @set. Все сказанное выше относится и к файлу gate.cfg, с той
разницей, что символ '@' в начале строки не нужен. В темплейтах
обрабатываются последовательности \n, \r, \t, \s, \%, \[, \\ (в gate.cfg
это не так, потому что символ '\' часто встречается в путях. В gate.cfg
вместо символа '[' нужно писать '[[]'). Можно также установить в
темплейте "@vars no" (в gate.cfg - "vars no"), и тогда до "@vars yes"
подстановка переменных производиться не будет, квадратными скобками
в этом случае можно пользоваться как обычно, не заменяя '[' на '[[]'.
Если в любом темплейте присвоить какое-либо значение переменной DontSend,
письмо не будет отправлено. Для reject-tpl и badaddr-tpl есть возможность
отправлять сообщения еще и гейтмастеру. Т.о. шлется два письма по одному
темплейту, но для письма гейтмастеру выставляется переменная ToMaster=yes,
которую можно использовать, например, чтобы не пересылать мастеру текст
самого письма, а только заголовок. В этом случае фрагмент темплейта будет
выглядеть так:
@if not "[ToMaster]"=="Yes"
@text
@endif

Значение переменной может браться из командной строки (ключ -d) или
из environment. Кроме того, существуют переменные

OS         - "OS/2" или "MSDOS";
Module     - "Fido2Rel", "Rel2Fido" или "Attuucp".

